/*! Spice 2014-06-06 */
!function(a,b,c){"use strict";function d(){throw"abstract method"}function e(){}function f(a,b){this.data=a,this.index=b}function g(){this._$el=b(document.createTextNode("")),this._contents=[]}function h(){}function i(a,b,c){this._el=a,this._context=b,this._cursor=c,this._init()}function j(a,b){this._streams=a,this._context=b,this._init()}function k(a,b){this._event=a,this._context=b,this._init()}f.prototype.eval=function(a){return a(this.data,this.index)},g.prototype.open=function(a){this._$el.appendTo(a)},g.prototype.close=function(){this._$el.remove()},g.prototype.write=function(a){this._contents.push(a),this._$el.before(a)},g.prototype.clear=function(){this._contents.forEach(function(a){b(a).remove()}),this._contents=[]},g.prototype.clone=function(){var a=new g;return this.write(a._$el),a},h.prototype._init=function(){this._tags={},this._modifiers={},this._name=null},h.prototype.defineTag=function(a,b){return this[a]=function(){var c=[].slice.call(arguments),d=b.apply(this,c);return d._name=a+"("+c.map(function(a){return a.toString()}).join(",")+")",d.parent(this)},this._tags[a]=b,this},h.prototype.defineModifier=function(a,b){return this[a]=function(){var a=[].slice.call(arguments);return this.call(function(c){var d=[c];b.apply(this,d.concat(a))}),this},this._modifiers[a]=b,this},h.prototype._defineAll=function(a,b){for(var c in a)a.hasOwnProperty(c)&&a[c]&&this.defineTag(c,a[c]);for(c in b)b.hasOwnProperty(c)&&b[c]&&this.defineModifier(c,b[c]);return this},h.prototype.each=d,h.prototype.$if=d,h.prototype._if=h.prototype.$if,h.prototype.$else=void 0,h.prototype.data=function(a){return this._context.data=a,this},h.prototype.index=function(a){return this._context.index=a,this},h.prototype.eval=function(a){return"function"==typeof a?this.eval(this._context.eval(a)):a instanceof c.Observable?a:c.once(a)},h.prototype.call=d,h.prototype.append=d,h.prototype.open=d,h.prototype.clear=d,h.prototype.parent=function(a){return this._parent=a,this._defineAll(a._tags,a._modifiers),this},h.prototype.close=function(){return this._parent},h.prototype.toString=function(){var a=[];return this._parent&&a.push(this._parent.toString()),this._name&&a.push(this._name),a.join(".")},i.prototype=new h,i.prototype._init=function(){this._cursor||(this._cursor=new g,this._cursor.open(this._el)),h.prototype._init.call(this),this._defineAll(l.tags,l.modifiers)},i.prototype.each=function(a){var b=this,c=b._cursor.clone(),d=new k(this.eval(a).delay(0).map(function(a){return new j(a.map(function(a,d){var e=new f(a,d),g=b._el,h=c.clone();return new i(g,e,h).parent(b)}),b._context).parent(b)}),b._context);return d._name="each(["+a.toString()+"])",d.parent(b)},i.prototype.$if=function(a){var b=this,d=this._cursor.clone();a=this.eval(a).delay(0);var e=a.map(function(a){var e=b._context,f=b._el,g=d.clone();return a?new i(f,e,g).parent(b):new k(c.never(),e).parent(b)}),f=a.not().map(function(a){var e=b._context,f=b._el,g=d.clone();return a?new i(f,e,g).parent(b):new k(c.never(),e).parent(b)}),g=new k(e,e._context);return g._name="$if("+a.toString()+")",g.$else=function(){var b=new k(f,f._context);return b._name="$if("+a.toString()+"):$else()",b.parent(this._parent)},g.parent(this)},i.prototype._if=i.prototype.$if,i.prototype.call=function(a){return a.call(this,this._el,this._context.data,this._context.index),this},i.prototype.append=function(a){return this._cursor.write(a),this},i.prototype.open=function(a){this.append(a);var b=new i(a,this._context);return b.parent(this)},i.prototype.clear=function(){return this._cursor.clear(),this},i.prototype.parent=function(a){return this._parent=a,this},j.prototype=new h,j.prototype.each=function(a){var b=new j(this._streams.map(function(b){return b.each(a)}),this._context);return b._name="each(["+a.toString()+"])",b.parent(this)},j.prototype.$if=function(a){var b=new j(this._streams.map(function(b){return b.$if(a)}),this._context);return b._name="$if("+a.toString()+")",b.$else=function(){var b=new j(this._streams.map(function(a){return a.$else()}),this._context);return b._name="$if("+a.toString()+"):$else()",b.parent(this._parent)},b.parent(this)},j.prototype._if=j.prototype.$if,j.prototype.call=function(a){return this._streams.forEach(function(b){b.call(a)}),this},j.prototype.append=function(a){return this._streams.forEach(function(b){b.append(a)}),this},j.prototype.open=function(a){return new j(this._streams.map(function(c){var d=b(a).clone()[0];return c.open(d)}),this._context).parent(this)},j.prototype.clear=function(){return this._streams.forEach(function(a){a.clear()}),this},k.prototype=new h,k.prototype._init=function(){this._event.onValue(e),this._event.slidingWindow(2).doAction(function(a){a[0]&&a[1]&&a[0].clear()}).onValue(e),h.prototype._init.call(this)},k.prototype.each=function(a){var b=new k(this._event.map(function(b){return b.each(a)}));return b._name="each(["+a.toString()+"])",b.parent(this)},k.prototype.$if=function(a){var b=new k(this._event.map(function(b){return b.$if(a)}),this._context);return b._name="$if("+a.toString()+")",b.$else=function(){var b=new k(this._event.map(function(a){return a.$else()}),this._context);return b._name="$if("+a.toString()+"):$else()",b.parent(this._parent)},b.parent(this)},k.prototype._if=k.prototype.$if,k.prototype.call=function(a){return this._event.onValue(function(b){b.call(a)}),this},k.prototype.append=function(a){return this._event.onValue(function(b){b.append(a)}),this},k.prototype.open=function(a){return new k(this._event.map(function(b){return b.open(a)}),this._context).parent(this)},k.prototype.clear=function(){return this._event.take(1).onValue(function(a){a.clear()}),this};var l=function(a){var b=new i(a,new f)._defineAll(l.tags,l.modifiers);return b};l.select=function(a){var c=b(a).toArray().map(function(a){return l(a)}),d=new j(c,new f)._defineAll(l.tags,l.modifiers);return d._name='$spice.select("'+a+'")',d},l.defineTag=function(a,b){l.tags[a]=b},l.defineModifier=function(a,b){l.modifiers[a]=b},l.modifiers={},l.tags={},l.VERSION="0.6.5",a.$spice=l}(this,window.jQuery,window.Bacon);