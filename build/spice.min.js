/*! Spice 2014-06-10 */
!function(a,b,c){"use strict";function d(){throw"abstract method"}function e(){}function f(){return(new Error).stack}function g(a,b){this.data=a,this.index=b}function h(){this._$el=b(document.createTextNode("")),this._contents=[]}function i(){}function j(a,b,c){this._el=a,this._context=b,this._cursor=c,this._init()}function k(a,b){this._streams=a,this._context=b,this._init()}function l(a,b){this._event=a,this._context=b,this._init()}g.prototype.eval=function(a){return a(this.data,this.index)},h.prototype.open=function(a){this._$el.appendTo(a)},h.prototype.close=function(){this._$el.remove()},h.prototype.write=function(a){this._contents.push(a),this._$el.before(a)},h.prototype.clear=function(){this._contents.forEach(function(a){b(a).remove()}),this._contents=[]},h.prototype.clone=function(){var a=new h;return this.write(a._$el),a},i.prototype._init=function(){this._tags={},this._modifiers={},this._name=null},i.prototype.defineTag=function(a,b){return this[a]=function(){var c=[].slice.call(arguments),d=b.apply(this,c);return d._name=a+"("+c.map(function(a){return a.toString()}).join(",")+")",d.parent(this)},this._tags[a]=b,this},i.prototype.defineModifier=function(a,b){return this[a]=function(){var a=[].slice.call(arguments);return this.call(function(c){var d=[c];b.apply(this,d.concat(a))}),this},this._modifiers[a]=b,this},i.prototype._defineAll=function(a,b){for(var c in a)a.hasOwnProperty(c)&&a[c]&&this.defineTag(c,a[c]);for(c in b)b.hasOwnProperty(c)&&b[c]&&this.defineModifier(c,b[c]);return this},i.prototype.each=d,i.prototype.$if=d,i.prototype._if=i.prototype.$if,i.prototype.$else=void 0,i.prototype.data=function(a){return this._context.data=a,this},i.prototype.index=function(a){return this._context.index=a,this},i.prototype.eval=function(a){return"function"==typeof a?this.eval(this._context.eval(a)):a instanceof c.Observable?a:c.once(a)},i.prototype.call=d,i.prototype.append=d,i.prototype.open=d,i.prototype.clear=d,i.prototype.parent=function(a){return this._parent=a,this._defineAll(a._tags,a._modifiers),this},i.prototype.close=function(){return this._parent},i.prototype.toString=function(){var a=[];return this._parent&&a.push(this._parent.toString()),this._name&&a.push(this._name),a.join(".")},j.prototype=new i,j.prototype._init=function(){this._cursor||(this._cursor=new h,this._cursor.open(this._el)),i.prototype._init.call(this)},j.prototype.each=function(a){var b=this,c=b._cursor.clone(),d=new l(this.eval(a).delay(0).map(function(a){return new k(a.map(function(a,d){var e=new g(a,d),f=b._el,h=c.clone();return new j(f,e,h).parent(b)}),b._context).parent(b)}),b._context);return d._name="each(["+a.toString()+"])",d.parent(b)},j.prototype.$if=function(a){var b=this,d=this._cursor.clone();a=this.eval(a).delay(0);var e=a.map(function(a){var e=b._context,f=b._el,g=d.clone();return a?new j(f,e,g).parent(b):new l(c.never(),e).parent(b)}),f=a.not().map(function(a){var e=b._context,f=b._el,g=d.clone();return a?new j(f,e,g).parent(b):new l(c.never(),e).parent(b)}),g=new l(e,e._context);return g._name="$if("+a.toString()+")",g.$else=function(){var b=new l(f,f._context);return b._name="$if("+a.toString()+"):$else()",b.parent(this._parent)},g.parent(this)},j.prototype._if=j.prototype.$if,j.prototype.call=function(a){return a.call(this,this._el,this._context.data,this._context.index),this},j.prototype.append=function(a){return this._cursor.write(a),this},j.prototype.open=function(a){m.debug&&b(a).data("spice",f),this.append(a);var c=new j(a,this._context);return c.parent(this)},j.prototype.clear=function(){return this._cursor.clear(),this},j.prototype.parent=function(a){return this._parent=a,this},k.prototype=new i,k.prototype.each=function(a){var b=new k(this._streams.map(function(b){return b.each(a)}),this._context);return b._name="each(["+a.toString()+"])",b.parent(this)},k.prototype.$if=function(a){var b=new k(this._streams.map(function(b){return b.$if(a)}),this._context);return b._name="$if("+a.toString()+")",b.$else=function(){var b=new k(this._streams.map(function(a){return a.$else()}),this._context);return b._name="$if("+a.toString()+"):$else()",b.parent(this._parent)},b.parent(this)},k.prototype._if=k.prototype.$if,k.prototype.call=function(a){return this._streams.forEach(function(b){b.call(a)}),this},k.prototype.append=function(a){return this._streams.forEach(function(b){b.append(a)}),this},k.prototype.open=function(a){return new k(this._streams.map(function(c){var d=b(a).clone()[0];return c.open(d)}),this._context).parent(this)},k.prototype.clear=function(){return this._streams.forEach(function(a){a.clear()}),this},l.prototype=new i,l.prototype._init=function(){this._event.onValue(e),this._event.slidingWindow(2).doAction(function(a){a[0]&&a[1]&&a[0].clear()}).onValue(e),i.prototype._init.call(this)},l.prototype.each=function(a){var b=new l(this._event.map(function(b){return b.each(a)}));return b._name="each(["+a.toString()+"])",b.parent(this)},l.prototype.$if=function(a){var b=new l(this._event.map(function(b){return b.$if(a)}),this._context);return b._name="$if("+a.toString()+")",b.$else=function(){var b=new l(this._event.map(function(a){return a.$else()}),this._context);return b._name="$if("+a.toString()+"):$else()",b.parent(this._parent)},b.parent(this)},l.prototype._if=l.prototype.$if,l.prototype.call=function(a){return this._event.onValue(function(b){b.call(a)}),this},l.prototype.append=function(a){return this._event.onValue(function(b){b.append(a)}),this},l.prototype.open=function(a){return new l(this._event.map(function(b){return b.open(a)}),this._context).parent(this)},l.prototype.clear=function(){return this._event.take(1).onValue(function(a){a.clear()}),this};var m=function(a){var b=new j(a,new g);return b};m.select=function(a){var c=b(a).toArray().map(function(a){return m(a)}),d=new k(c,new g);return d._name='$spice.select("'+a+'")',d},m.defineTag=function(a,b){i.prototype[a]=function(){var c=[].slice.call(arguments),d=b.apply(this,c);return d._name=a+"("+c.map(function(a){return a.toString()}).join(",")+")",d.parent(this)}},m.defineModifier=function(a,b){i.prototype[a]=function(){var a=[].slice.call(arguments);return this.call(function(c){var d=[c];b.apply(this,d.concat(a))}),this}},m.VERSION="0.6.5",m.debug=!1,a.$spice=m}(this,window.jQuery,window.Bacon);