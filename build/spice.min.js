/*! Spice 2014-04-25 */
!function(a,b){"use strict";function c(){throw"abstract method"}function d(){}function e(a,b){this.data=a,this.index=b}function f(){this._$el=a(document.createTextNode("")),this._contents=[]}function g(){}function h(a,b,c){this._el=a,this._context=b,this._cursor=c,this._init()}function i(a,b){this._streams=a,this._context=b,this._init()}function j(a,b){this._event=a,this._context=b,this._init()}e.prototype.eval=function(a){return a(this.data,this.index)},f.prototype.open=function(a){this._$el.appendTo(a)},f.prototype.close=function(){this._$el.remove()},f.prototype.write=function(a){this._contents.push(a),this._$el.before(a)},f.prototype.clear=function(){this._contents.forEach(function(b){a(b).remove()}),this._contents=[]},f.prototype.clone=function(){var a=new f;return this.write(a._$el),a},g.prototype._init=function(){this._tags={},this._modifiers={}},g.prototype.defineTag=function(a,b){return this[a]=function(){var a=[].slice.call(arguments);return b.apply(this,a).parent(this)},this._tags[a]=b,this},g.prototype.defineModifier=function(a,b){return this[a]=function(){var a=[].slice.call(arguments);return this.call(function(c){var d=[c];b.apply(this,d.concat(a))}),this},this._modifiers[a]=b,this},g.prototype._defineAll=function(a,b){for(var c in a)a.hasOwnProperty(c)&&a[c]&&this.defineTag(c,a[c]);for(c in b)b.hasOwnProperty(c)&&b[c]&&this.defineModifier(c,b[c]);return this},g.prototype.each=c,g.prototype.$if=c,g.prototype._if=g.prototype.$if,g.prototype.$else=void 0,g.prototype.data=function(a){return this._context.data=a,this},g.prototype.index=function(a){return this._context.index=a,this},g.prototype.eval=function(a){return"function"==typeof a?this.eval(this._context.eval(a)):a instanceof b.Observable?a:b.once(a)},g.prototype.call=c,g.prototype.append=c,g.prototype.open=c,g.prototype.clear=c,g.prototype.parent=function(a){return this._parent=a,this._defineAll(a._tags,a._modifiers),this},g.prototype.bindClose=g.prototype.parent,g.prototype.close=function(){return this._parent},h.prototype=new g,h.prototype._init=function(){this._cursor||(this._cursor=new f,this._cursor.open(this._el)),g.prototype._init.call(this),this._defineAll(k.tags,k.modifiers)},h.prototype.each=function(a){var b=this,c=b._cursor.clone();return new j(this.eval(a).delay(0).map(function(a){return new i(a.map(function(a,d){var f=new e(a,d),g=b._el,i=c.clone();return new h(g,f,i).parent(b)}),b._context).parent(b)}),b._context).parent(b)},h.prototype.$if=function(a){var c=this,d=this._cursor.clone();a=this.eval(a).delay(0);var e=a.map(function(a){var e=c._context,f=c._el,g=d.clone();return a?new h(f,e,g).parent(c):new j(b.never(),e).parent(c)}),f=a.not().map(function(a){var e=c._context,f=c._el,g=d.clone();return a?new h(f,e,g).parent(c):new j(b.never(),e).parent(c)}),g=new j(e,e._context).parent(this);return g.$else=function(){return new j(f,f._context).parent(this._parent)},g},h.prototype._if=h.prototype.$if,h.prototype.call=function(a){return a.call(this,this._el,this._context.data,this._context.index),this},h.prototype.append=function(a){return this._cursor.write(a),this},h.prototype.open=function(a){return this.append(a),new h(a,this._context).parent(this)},h.prototype.clear=function(){return this._cursor.clear(),this},h.prototype.parent=function(a){return this._parent=a,this},h.prototype.bindClose=h.prototype.parent,i.prototype=new g,i.prototype.each=function(a){return new i(this._streams.map(function(b){return b.each(a)}),this._context).parent(this)},i.prototype.$if=function(a){var b=new i(this._streams.map(function(b){return b.$if(a)}),this._context).parent(this);return b.$else=function(){return new i(this._streams.map(function(a){return a.$else()}),this._context).parent(this._parent)},b},i.prototype._if=i.prototype.$if,i.prototype.call=function(a){return this._streams.forEach(function(b){b.call(a)}),this},i.prototype.append=function(a){return this._streams.forEach(function(b){b.append(a)}),this},i.prototype.open=function(b){return new i(this._streams.map(function(c){var d=a(b).clone()[0];return c.open(d)}),this._context).parent(this)},i.prototype.clear=function(){return this._streams.forEach(function(a){a.clear()}),this},j.prototype=new g,j.prototype._init=function(){this._event.onValue(d),this._event.slidingWindow(2).doAction(function(a){a[0]&&a[1]&&a[0].clear()}).onValue(d),g.prototype._init.call(this)},j.prototype.each=function(a){return new j(this._event.map(function(b){return b.each(a)})).parent(this)},j.prototype.$if=function(a){var b=new j(this._event.map(function(b){return b.$if(a)}),this._context).parent(this);return b.$else=function(){return new j(this._event.map(function(a){return a.$else()}),this._context).parent(this._parent)},b},j.prototype._if=j.prototype.$if,j.prototype.call=function(a){return this._event.onValue(function(b){b.call(a)}),this},j.prototype.append=function(a){return this._event.onValue(function(b){b.append(a)}),this},j.prototype.open=function(a){return new j(this._event.map(function(b){return b.open(a)}),this._context).parent(this)},j.prototype.clear=function(){return this._event.take(1).onValue(function(a){a.clear()}),this};var k=function(a){var b=new h(a,new e)._defineAll(k.tags,k.modifiers);return b};k.select=function(b){var c=a(b).toArray().map(function(a){return k(a)}),d=new i(c,new e)._defineAll(k.tags,k.modifiers);return d},k.modifiers={},k.tags={},window.$spice=k}(window.jQuery,window.Bacon);