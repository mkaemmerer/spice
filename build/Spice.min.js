/*! Spice 2014-03-31 */
!function(a,b){"use strict";function c(){throw"abstract method"}function d(a){return a}function e(){}function f(a,b){this.data=a,this.index=b}function g(){this._$el=a(document.createTextNode("")),this._contents=[]}function h(){}function i(a,b,c){this._el=a,this._context=b,this._cursor=c,this._init()}function j(a,b){this._streams=a,this._context=b,this._init()}function k(a,b){this._event=a,this._context=b,this._init()}function l(a,b,c){this._trues=b.filter(d).map(a),this._falses=b.not().filter(d).map(a),this._event=this._trues,this._context=c,this._init()}f.prototype.eval=function(a){return a(this.data,this.index)},g.prototype.open=function(a){this._$el.appendTo(a)},g.prototype.close=function(){this._$el.remove()},g.prototype.write=function(a){this._contents.push(a),this._$el.before(a)},g.prototype.clear=function(){this._contents.forEach(function(b){a(b).remove()})},g.prototype.clone=function(){var a=new g;return this.write(a._$el),a},h.prototype._init=function(){this._tags={},this._modifiers={}},h.prototype.defineTag=function(a,b){return this[a]=function(){var a=[].slice.call(arguments);return b.apply(this,a).parent(this)},this._tags[a]=b,this},h.prototype.defineModifier=function(a,b){return this[a]=function(){var a=[].slice.call(arguments);return this.call(function(c){var d=[c];b.apply(this,d.concat(a))}),this},this._modifiers[a]=b,this},h.prototype._defineAll=function(a,b){for(var c in a)a.hasOwnProperty(c)&&a[c]&&this.defineTag(c,a[c]);for(c in b)b.hasOwnProperty(c)&&b[c]&&this.defineModifier(c,b[c]);return this},h.prototype.each=c,h.prototype.$if=function(a){return new l(this,this.eval(a),this._context).parent(this)},h.prototype._if=h.prototype.$if,h.prototype.$else=void 0,h.prototype.data=function(a){return this._context.data=a,this},h.prototype.index=function(a){return this._context.index=a,this},h.prototype.eval=function(a){return"function"==typeof a?this.eval(this._context.eval(a)):a instanceof b.Observable?a:b.once(a)},h.prototype.call=c,h.prototype.append=c,h.prototype.open=c,h.prototype.clear=c,h.prototype.parent=function(a){return this._parent=a,this._defineAll(a._tags,a._modifiers),this},h.prototype.bindClose=h.prototype.parent,h.prototype.close=function(){return this._parent},i.prototype=new h,i.prototype._init=function(){this._cursor||(this._cursor=new g,this._cursor.open(this._el)),h.prototype._init.call(this),this._defineAll(m.tags,m.modifiers)},i.prototype.each=function(a){var b=this,c=b._cursor.clone();return new k(this.eval(a).delay(0).map(function(a){return new j(a.map(function(a,d){var e=new f(a,d),g=b._el,h=c.clone();return new i(g,e,h).parent(b)}),b._context).parent(b)}),b._context).parent(b)},i.prototype.call=function(a){return a.call(this,this._el,this._context.data,this._context.index),this},i.prototype.append=function(a){return this._cursor.write(a),this},i.prototype.open=function(a){return this.append(a),new i(a,this._context).parent(this)},i.prototype.clear=function(){return this._cursor.clear(),this},i.prototype.parent=function(a){return this._parent=a,this},i.prototype.bindClose=i.prototype.parent,j.prototype=new h,j.prototype.each=function(a){return new j(this._streams.map(function(b){return b.each(a)}),this._context)},j.prototype.call=function(a){return this._streams.forEach(function(b){b.call(a)}),this},j.prototype.append=function(a){return this._streams.forEach(function(b){b.append(a)}),this},j.prototype.open=function(b){return new j(this._streams.map(function(c){var d=a(b).clone()[0];return c.open(d)}),this._context).parent(this)},j.prototype.clear=function(){return this._streams.forEach(function(a){a.clear()}),this},k.prototype=new h,k.prototype._init=function(){this._event.onValue(e),this._event.slidingWindow(2).onValue(function(a){a[0]&&a[0].clear()}),h.prototype._init.call(this)},k.prototype.each=function(a){return new k(this._event.map(function(b){return b.each(a)})).parent(this)},k.prototype.$if=function(a){return new k(this._event.map(function(b){return b.$if(a)}),this._context).parent(this)},k.prototype._if=k.prototype.$if,k.prototype.call=function(a){return this._event.onValue(function(b){b.call(a)}),this},k.prototype.append=function(a){return this._event.onValue(function(b){b.append(a)}),this},k.prototype.open=function(a){return new k(this._event.map(function(b){return b.open(a)}),this._context).parent(this)},k.prototype.clear=function(){return this._event.take(1).onValue(function(a){a.clear()}),this},l.prototype=new k(b.never()),l.prototype.$else=function(){return new k(this._falses,this._context)},l.prototype._else=l.prototype.$else;var m=function(a){var b=new i(a,new f)._defineAll(m.tags,m.modifiers);return b};m.select=function(b){var c=a(b).toArray().map(function(a){return m(a)}),d=new j(c,new f)._defineAll(m.tags,m.modifiers);return d},m.modifiers={},m.tags={},window.$spice=m}(window.jQuery,window.Bacon);