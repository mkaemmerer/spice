/*! Spice 2014-12-11 */
!function(a,b,c){"use strict";function d(){throw"abstract method"}function e(){}function f(){return(new Error).stack}function g(a){return a instanceof c.Observable?a.toProperty():c.constant(a)}function h(a,b){this.data=a,this.index=b}function i(){this._$el=b(document.createTextNode("")),this._contents=[]}function j(){}function k(a,b,c){this._el=a,this._context=b,this._cursor=c,this._init()}function l(a,b){this._streams=a,this._context=b,this._init()}function m(a,b){this._event=a,this._context=b,this._init()}h.prototype.eval=function(a){return a(this.data,this.index)},i.prototype.open=function(a){this._$el.appendTo(a)},i.prototype.close=function(){this._$el.remove()},i.prototype.write=function(a){this._contents.push(a),this._$el.before(a)},i.prototype.clear=function(){this._contents.forEach(function(a){b(a).remove()}),this._contents=[]},i.prototype.clone=function(){var a=new i;return this.write(a._$el),a},j.prototype._init=function(){this._tags={},this._modifiers={},this._clear=new c.Bus,this._name=null},j.prototype.defineTag=function(a,b){return b.displayName=b.displayName||a,this[a]=function(){var c=[].slice.call(arguments),d=b.apply(this,c);return d._name=a+"("+c.map(function(a){return a.toString()}).join(",")+")",d.parent(this)},this[a].displayName="tag",this._tags[a]=b,this},j.prototype.defineModifier=function(a,b){return b.displayName=b.displayName||a,this[a]=function(){var a=[].slice.call(arguments);return this.call(function(c){var d=[c];b.apply(this,d.concat(a))}),this},this[a].displayName="modifier",this._modifiers[a]=b,this},j.prototype._defineAll=function(a,b){for(var c in a)a.hasOwnProperty(c)&&a[c]&&!this._tags[c]&&this.defineTag(c,a[c]);for(c in b)b.hasOwnProperty(c)&&b[c]&&!this._modifiers[c]&&this.defineModifier(c,b[c]);return this},j.prototype.each=d,j.prototype.$if=d,j.prototype.$else=void 0,j.prototype.data=function(a){return this._context.data=a,this},j.prototype.index=function(a){return this._context.index=a,this},j.prototype.eval=function(a,b){return"function"==typeof a&&(a=this._context.eval(a)),b?a:g(a).takeUntil(this._clear)},j.prototype.call=d,j.prototype.append=d,j.prototype.open=d,j.prototype.clear=d,j.prototype.onClear=d,j.prototype.parent=function(a){return this._parent=a,this._defineAll(a._tags,a._modifiers),this._clear.plug(a._clear),this},j.prototype.close=function(){return this._parent},j.prototype.toString=function(){var a=[];return this._parent&&a.push(this._parent.toString()),this._name&&a.push(this._name),a.join(".")},k.prototype=new j,k.prototype._init=function(){this._cursor||(this._cursor=new i,this._cursor.open(this._el)),j.prototype._init.call(this)},k.prototype.each=function(a){var b=this,c=b._cursor.clone(),d=new m(this.eval(a).map(function(a){var d=new l(a.map(function(a,d){var e=new h(a,d),f=b._el,g=c.clone();return new k(f,e,g).parent(b)}),b._context);return d._name="each(["+a.toString()+"])",d.parent(b)}),b._context);return d._name="each(["+a.toString()+"])",d.parent(b)},k.prototype.$if=function(a){var b=this,d=this._cursor.clone();a=this.eval(a);var e=a.map(function(a){var e=b._context,f=b._el,g=d.clone();return a?new k(f,e,g).parent(b):new m(c.never(),e).parent(b)}),f=a.not().map(function(a){var e=b._context,f=b._el,g=d.clone();return a?new k(f,e,g).parent(b):new m(c.never(),e).parent(b)}),g=new m(e,e._context);return g._name="$if("+a.toString()+")",g.$else=function(){var b=new m(f,f._context);return b._name="$if("+a.toString()+"):$else()",b.parent(this._parent)},g.parent(this)},k.prototype.call=function(a){return a.call(this,this._el,this._context.data,this._context.index),this},k.prototype.append=function(a){return this._cursor.write(a),this},k.prototype.open=function(a){n.debug&&b(a).data("spice",f()),this.append(a);var c=new k(a,this._context);return c.parent(this)},k.prototype.clear=function(){return this._clear.push({}),this._cursor.clear(),this},k.prototype.onClear=function(a){this._clear.onValue(function(){this.call(a)}.bind(this))},l.prototype=new j,l.prototype.each=function(a){var b=new l(this._streams.map(function(b){return b.each(a)}),this._context);return b._name="each(["+a.toString()+"])",b.parent(this)},l.prototype.$if=function(a){var b=new l(this._streams.map(function(b){return b.$if(a)}),this._context);return b._name="$if("+a.toString()+")",b.$else=function(){var b=new l(this._streams.map(function(a){return a.$else()}),this._context);return b._name="$if("+a.toString()+"):$else()",b.parent(this._parent)},b.parent(this)},l.prototype.call=function(a){return this._streams.forEach(function(b){b.call(a)}),this},l.prototype.append=function(a){return this._streams.forEach(function(b){b.append(a)}),this},l.prototype.open=function(a){return new l(this._streams.map(function(c){var d=b(a).clone()[0];return c.open(d)}),this._context).parent(this)},l.prototype.clear=function(){return this._streams.forEach(function(a){a.clear()}),this},l.prototype.onClear=function(a){return this._streams.forEach(function(b){b.onClear(a)}),this},m.prototype=new j,m.prototype._init=function(){this._event.onValue(e),this._event.slidingWindow(2).doAction(function(a){a[0]&&a[1]&&a[0].clear()}).onValue(e),j.prototype._init.call(this)},m.prototype.each=function(a){var b=new m(this._event.map(function(b){return b.each(a)}));return b._name="each(["+a.toString()+"])",b.parent(this)},m.prototype.$if=function(a){var b=new m(this._event.map(function(b){return b.$if(a)}),this._context);return b._name="$if("+a.toString()+")",b.$else=function(){var b=new m(this._event.map(function(a){return a.$else()}),this._context);return b._name="$if("+a.toString()+"):$else()",b.parent(this._parent)},b.parent(this)},m.prototype.call=function(a){return this._event.onValue(function(b){b.call(a)}),this},m.prototype.append=function(a){return this._event.onValue(function(b){b.append(a)}),this},m.prototype.open=function(a){return new m(this._event.map(function(b){return b.open(a)}),this._context).parent(this)},m.prototype.clear=function(){return this._event.onValue(function(a){a.clear()}),this},m.prototype.onClear=function(a){return this._event.onValue(function(b){b.onClear(a)}),this};var n=function(a){var b=new k(a,new h);return b};n.select=function(a){var c=b(a).toArray().map(function(a){return n(a)}),d=new l(c,new h);return d._name='$spice.select("'+a+'")',d},n.defineTag=function(a,b){return b.displayName=b.displayName||a,j.prototype[a]=function(){var c=[].slice.call(arguments),d=b.apply(this,c);return d._name=a+"("+c.map(function(a){return a.toString()}).join(",")+")",d.parent(this)},j.prototype[a].displayName="tag",n},n.defineModifier=function(a,b){return b.displayName=b.displayName||a,j.prototype[a]=function(){var a=[].slice.call(arguments);return this.call(function(c){var d=[c];b.apply(this,d.concat(a))}),this},j.prototype[a].displayName="modifier",n},n.VERSION="0.6.9",n.debug=!1,a.$spice=n}(this,window.jQuery,window.Bacon);